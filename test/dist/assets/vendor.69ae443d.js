var t,e,r,n=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(t,e,r)=>e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c=(t,e)=>{for(var r in e||(e={}))a.call(e,r)&&u(t,r,e[r]);if(i)for(var r of i(e))l.call(e,r)&&u(t,r,e[r]);return t},h=(t,e)=>o(t,s(e)),d=("undefined"!=typeof require&&require,(t,e)=>{var r={};for(var n in t)a.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&i)for(var n of i(t))e.indexOf(n)<0&&l.call(t,n)&&(r[n]=t[n]);return r}),f=(t,e,r)=>(u(t,"symbol"!=typeof e?e+"":e,r),r),p=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},m=(t,e,r)=>(p(t,e,"read from private field"),r?r.call(t):e.get(t)),g=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},$=(t,e,r,n)=>(p(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);function y(){}function b(t,e){for(const r in e)t[r]=e[r];return t}function w(t){return t()}function v(){return Object.create(null)}function R(t){t.forEach(w)}function x(t){return"function"==typeof t}function N(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function E(t,...e){if(null==t)return y;const r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function P(t){let e;return E(t,(t=>e=t))(),e}function _(t,e,r,n){if(t){const o=C(t,e,r,n);return t[0](o)}}function C(t,e,r,n){return t[1]&&n?b(r.ctx.slice(),t[1](n(e))):r.ctx}function U(t,e,r,n){if(t[2]&&n){const o=t[2](n(r));if(void 0===e.dirty)return o;if("object"==typeof o){const t=[],r=Math.max(e.dirty.length,o.length);for(let n=0;n<r;n+=1)t[n]=e.dirty[n]|o[n];return t}return e.dirty|o}return e.dirty}function I(t,e,r,n,o,s){if(o){const i=C(e,r,n,s);t.p(i,o)}}function F(t){if(t.ctx.length>32){const e=[],r=t.ctx.length/32;for(let t=0;t<r;t++)e[t]=-1;return e}return-1}function O(t){return t&&x(t.destroy)?t.destroy:y}function S(t,e,r){t.insertBefore(e,r||null)}function j(t){t.parentNode.removeChild(t)}function k(t){return document.createElement(t)}function A(t){return document.createTextNode(t)}function D(){return A("")}let H;function L(t){H=t}function B(){if(!H)throw new Error("Function called outside component initialization");return H}function T(t,e){B().$$.context.set(t,e)}function W(t){return B().$$.context.get(t)}const q=[],M=[],V=[],J=[],K=Promise.resolve();let z=!1;function G(t){V.push(t)}let Q=!1;const X=new Set;function Y(){if(!Q){Q=!0;do{for(let t=0;t<q.length;t+=1){const e=q[t];L(e),Z(e.$$)}for(L(null),q.length=0;M.length;)M.pop()();for(let t=0;t<V.length;t+=1){const e=V[t];X.has(e)||(X.add(e),e())}V.length=0}while(q.length);for(;J.length;)J.pop()();z=!1,Q=!1,X.clear()}}function Z(t){if(null!==t.fragment){t.update(),R(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(G)}}const tt=new Set;let et;function rt(){et={r:0,c:[],p:et}}function nt(){et.r||R(et.c),et=et.p}function ot(t,e){t&&t.i&&(tt.delete(t),t.i(e))}function st(t,e,r,n){if(t&&t.o){if(tt.has(t))return;tt.add(t),et.c.push((()=>{tt.delete(t),n&&(r&&t.d(1),n())})),t.o(e)}}function it(t,e){const r={},n={},o={$$scope:1};let s=t.length;for(;s--;){const i=t[s],a=e[s];if(a){for(const t in i)t in a||(n[t]=1);for(const t in a)o[t]||(r[t]=a[t],o[t]=1);t[s]=a}else for(const t in i)o[t]=1}for(const i in n)i in r||(r[i]=void 0);return r}function at(t){return"object"==typeof t&&null!==t?t:{}}function lt(t){t&&t.c()}function ut(t,e,r,n){const{fragment:o,on_mount:s,on_destroy:i,after_update:a}=t.$$;o&&o.m(e,r),n||G((()=>{const e=s.map(w).filter(x);i?i.push(...e):R(e),t.$$.on_mount=[]})),a.forEach(G)}function ct(t,e){const r=t.$$;null!==r.fragment&&(R(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function ht(t,e){-1===t.$$.dirty[0]&&(q.push(t),z||(z=!0,K.then(Y)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function dt(t,e,r,n,o,s,i,a=[-1]){const l=H;L(t);const u=t.$$={fragment:null,ctx:null,props:s,update:y,not_equal:o,bound:v(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:v(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(u.root);let c=!1;if(u.ctx=r?r(t,e.props||{},((e,r,...n)=>{const s=n.length?n[0]:r;return u.ctx&&o(u.ctx[e],u.ctx[e]=s)&&(!u.skip_bound&&u.bound[e]&&u.bound[e](s),c&&ht(t,e)),r})):[],u.update(),c=!0,R(u.before_update),u.fragment=!!n&&n(u.ctx),e.target){if(e.hydrate){const t=(h=e.target,Array.from(h.childNodes));u.fragment&&u.fragment.l(t),t.forEach(j)}else u.fragment&&u.fragment.c();e.intro&&ot(t.$$.fragment),ut(t,e.target,e.anchor,e.customElement),Y()}var h;L(l)}class ft{$destroy(){ct(this,1),this.$destroy=y}$on(t,e){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const pt=[];function mt(t,e=y){let r;const n=new Set;function o(e){if(N(t,e)&&(t=e,r)){const e=!pt.length;for(const r of n)r[1](),pt.push(r,t);if(e){for(let t=0;t<pt.length;t+=2)pt[t][0](pt[t+1]);pt.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(s,i=y){const a=[s,i];return n.add(a),1===n.size&&(r=e(o)||y),s(t),()=>{n.delete(a),0===n.size&&(r(),r=null)}}}}function gt(t,e,r){const n=!Array.isArray(t),o=n?[t]:t,s=e.length<2;return{subscribe:mt(r,(t=>{let r=!1;const i=[];let a=0,l=y;const u=()=>{if(a)return;l();const r=e(n?i[0]:i,t);s?t(r):l=x(r)?r:y},c=o.map(((t,e)=>E(t,(t=>{i[e]=t,a&=~(1<<e),r&&u()}),(()=>{a|=1<<e}))));return r=!0,u(),function(){R(c),l()}})).subscribe}}class $t{constructor(e,r,n){g(this,t,{}),this.route=e,this.node=r,this.load=void 0,this.urlFragment=n,Object.defineProperty(this,"route",{enumerable:!1})}get params(){return m(this,t)}setParams(e){$(this,t,e)}getParamsFromFragment(){const{getFieldsFromName:t,getValuesFromPath:e,mapFieldsWithValues:r}=this.route.router.instance.utils;return r(t(this.node.name),e(this.node.regex,this.urlFragment))}}t=new WeakMap;const yt=t=>t.name.match(/\[\.\.\.(.+)\]/)?1:-1,bt=t=>{var e;for(const r of[...t].reverse())for(const t of(null==(e=r.node.parent)?void 0:e.children)||[]){if(t.name.match(/\[\.\.\.(.+)\]/))return t}},wt=(t,e)=>t.findIndex((t=>t.node===e)),vt=["pushState","replaceState","popState"];class Rt{constructor(t,e,r){if(f(this,"allFragments",[]),f(this,"loaded"),f(this,"invalid",null),this.router=t,this.url=e,this.mode=r,!t.rootNode){this.router.log.error("Can't navigate without a rootNode");const e=new Error("Can't navigate without a rootNode");throw Object.assign(e,{routify:{router:t}}),e}if(!vt.includes(r))throw new Error("url.mode must be pushState, replaceState or popState");this.allFragments=this._createFragments()}get fragments(){const t=this.allFragments.filter((t=>t.node.module));return this.router.transformFragments.run(t)}get params(){const t=this.url.match(/\?.+/),e=t&&t[0];return Object.assign({},...this.allFragments.map((t=>t.params)),e&&this.router.queryHandler.parse(e))}async loadRoute(){const{router:t}=this,e=[this.runBeforeUrlChangeHooks,this.loadComponents,this.runGuards,this.runPreloads];return this.loaded=new Promise((async(r,n)=>{for(const s of e){const e=await s.bind(this)(),o=this!==t.pendingRoute.get();if(o)t.pendingRoute.get().loaded.then(r).catch(n);else if(!e)return t.pendingRoute.set(null),!1;if(!e||o)return}const o=this.router.activeRoute.get();o&&t.history.push(o),t.activeRoute.set(this),t.afterUrlChange.run({route:this,history:[...t.history].reverse()}),t.pendingRoute.set(null),r({route:this})})),this.loaded}async loadComponents(){return await Promise.all(this.fragments.map((async t=>{const e=await t.node.module();t.node.module=()=>e}))),!0}async runPreloads(){const t={route:this,node:[...this.fragments].pop().node},e=this.fragments.filter((t=>{var e;return null==(e=t.node.module())?void 0:e.load})).map((async e=>e.load=await e.node.module().load(t)));return await Promise.all(e),!0}async runGuards(){const t=this.fragments.map((t=>t.node.module())).filter((t=>null==t?void 0:t.guard));for(const e of t){if(!(await e.guard(this))||this.invalid)return!1}return!0}async runBeforeUrlChangeHooks(){return await this.router.beforeUrlChange.run({route:this})}_createFragments(){const{url:t="",router:e}=this,{rootNode:r}=e;let n=[],o=r;const s=(t,e,r)=>{const n=new $t(this,t,e),o=t.name.match(/\[\.\.\.(.+)\]/);return o?r.push(e):r=[],o?n.setParams({[o[1]]:r}):n.setParams(n.getParamsFromFragment()),n},i=(t=>t.replace(/[?#].+/,"").replace(/\/$/,"").split("/").slice(1))(t),a=[new $t(this,o,"")];for(let u=0;u<i.length;u++){const r=i[u],l=o.children.filter((t=>!t.name.startsWith("_"))),c=l.find((t=>t.name===r))||l.sort(yt).find((t=>t.regex.test(r)));if(c)a.push(s(c,r,n)),o=c;else if(n.length)n.push(r);else{const r=bt(a);if(!r){const r=o._fallback;if(!r)throw new Error(`router: "${e.name||"[default]"}" could not find route: ${t}`);a.splice(r.level),a.push(new $t(this,r,""));break}{const t=wt(a,r);u-=a.splice(t).length,a.push(s(r,i[u],n)),o=r}}}let l=a[a.length-1].node;for(;l;)l=l.children.find((t=>"index"===t.name)),l&&a.push(new $t(this,l,""));if(!a.filter((({node:t})=>t.module)).length)throw new Error(`could not find route: ${t}`);return a}}const xt=(t,e)=>{const r=mt(t,e);return Object.assign(r,{get:()=>P(r)})};class Nt{constructor(t){this.router=t,this.log=this.router.log}install(){}uninstall(){}reflect(){}}const Et=(t=100)=>new Promise((e=>{let r;const n=async o=>{clearTimeout(r),await new Promise(requestAnimationFrame),r=setTimeout((()=>{e(),removeEventListener("scroll",n)}),t)};addEventListener("scroll",n)})),Pt=mt(!1),_t={isScrolling:Pt,run:({route:t,history:e})=>{var r;const[n,o]=t.url.split("#"),[s,i]=(null==(r=e[0])?void 0:r.url.split("#"))||[];if(!o)return;const a=async t=>{const e=n===s,r=document.getElementById(o);if(r&&r.scrollIntoView({behavior:e?"smooth":"auto"}),e&&r&&(Pt.set(!0),await Et(),Pt.set(!1)),!e&&!t){const t=new MutationObserver(a);t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),setTimeout(t.disconnect.bind(t),500)}};a()}};const Ct=new class{constructor(){f(this,"instances",[]),f(this,"browserAdapter",(t=>{const e=(null==t?void 0:t.delimiter)||";";return{toRouter:(t,r)=>{const n=r.name?`${r.name}=(.+?)`:"(.+?)",o=new RegExp(`(^|${e})${n}(${e}|$)`),s=t.match(o);return s?s[2]:"/"},toBrowser:t=>t.map((t=>(t.name?`${t.name}=`:"")+t.url.external())).join(e)}})()),f(this,"urlFromBrowser",(t=>this.browserAdapter.toRouter((({pathname:t,search:e,hash:r})=>t+e+r)(window.location),t))),"undefined"!=typeof window&&(window.__routify=this)}get routers(){return[].concat(...this.instances.map((t=>t.routers)))}register(t){return this.instances.push(t),this}},Ut=/\[(.+?)\]/gm;class It{constructor(t=Ut){f(this,"getFieldsFromName",(t=>[...t.matchAll(this.RE)].map((t=>t[1])))),f(this,"getRegexFromName",(t=>new RegExp("^"+t.replace(this.RE,"(.+)")+"$"))),f(this,"getValuesFromPath",((t,e)=>(e.match(t)||[]).slice(1))),f(this,"mapFieldsWithValues",((t,e)=>this.haveEqualLength(t,e)&&t.reduce(((t,r,n)=>(t[r]=e[n],t)),{}))),f(this,"haveEqualLength",((t,e)=>{if(t.length!==e.length)throw new Error(`fields and values should be of same length\nfields: ${JSON.stringify(t)}\nvalues: ${JSON.stringify(e)}`);return!0})),this.RE=t}}class Ft{constructor(t,e,r){f(this,"instance"),f(this,"parent"),f(this,"meta",{}),f(this,"id"),this.instance=r,this.name=t,r.nodeIndex.push(this),this.module=e,Object.defineProperty(this,"Instance",{enumerable:!1}),Object.defineProperty(this,"instance",{enumerable:!1}),Object.defineProperty(this,"parent",{enumerable:!1})}appendChild(t){t.parent=this}createChild(t,e){const r=this.instance.createNode(t,e);return this.appendChild(r),r}get descendants(){return this.instance.nodeIndex.filter((t=>t.ancestors.find((t=>t===this))))}remove(){const{nodeIndex:t}=this.instance,e=t.findIndex((t=>t===this));t.splice(e,1)}get ancestors(){let t=this;const e=[];for(;t=t.parent;)e.push(t);return e}get root(){let t=this;for(;t.parent;)t=t.parent;return t}get isRoot(){return this===this.root}get children(){return this.instance.nodeIndex.filter((t=>t.parent===this))}get level(){var t;return((null==(t=this.parent)?void 0:t.level)||0)+1}traverse(t){const e=t.startsWith("/")?this.root:this,r=t.split("/").filter((t=>"."!==t)).filter(Boolean);try{return r.reduce(((t,e)=>".."===e?t.parent:t.children.find((t=>t.name===e))),e)}catch(n){console.error("can't resolve path",t,"from",this.path,"\n",n)}}toJSON(){return h(c({},this),{children:[...this.children]})}get path(){return"/"+[this,...this.ancestors].reverse().map((t=>t.name)).filter(Boolean).join("/")}}function Ot(t){let e;const r=t[4].default,n=_(r,t,t[5],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,o){n&&n.p&&(!e||32&o)&&I(n,r,t,t[5],e?U(r,t[5],o,null):F(t[5]),null)},i(t){e||(ot(n,t),e=!0)},o(t){st(n,t),e=!1},d(t){n&&n.d(t)}}}function St(t){let e,r,n=t[2]&&jt(t);return{c(){n&&n.c(),e=D()},m(t,o){n&&n.m(t,o),S(t,e,o),r=!0},p(t,r){t[2]?n?(n.p(t,r),4&r&&ot(n,1)):(n=jt(t),n.c(),ot(n,1),n.m(e.parentNode,e)):n&&(rt(),st(n,1,1,(()=>{n=null})),nt())},i(t){r||(ot(n),r=!0)},o(t){st(n),r=!1},d(t){n&&n.d(t),t&&j(e)}}}function jt(t){let e,r;const n=[t[1],{context:t[3]}];let o={$$slots:{default:[kt]},$$scope:{ctx:t}};for(let s=0;s<n.length;s+=1)o=b(o,n[s]);return e=new t[2]({props:o}),{c(){lt(e.$$.fragment)},m(t,n){ut(e,t,n),r=!0},p(t,r){const o=10&r?it(n,[2&r&&at(t[1]),8&r&&{context:t[3]}]):{};32&r&&(o.$$scope={dirty:r,ctx:t}),e.$set(o)},i(t){r||(ot(e.$$.fragment,t),r=!0)},o(t){st(e.$$.fragment,t),r=!1},d(t){ct(e,t)}}}function kt(t){let e;const r=t[4].default,n=_(r,t,t[5],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,o){n&&n.p&&(!e||32&o)&&I(n,r,t,t[5],e?U(r,t[5],o,null):F(t[5]),null)},i(t){e||(ot(n,t),e=!0)},o(t){st(n,t),e=!1},d(t){n&&n.d(t)}}}function At(t){let e,r,n,o;const s=[St,Ot],i=[];function a(t,e){return t[0].module?0:1}return e=a(t),r=i[e]=s[e](t),{c(){r.c(),n=D()},m(t,r){i[e].m(t,r),S(t,n,r),o=!0},p(t,[o]){let l=e;e=a(t),e===l?i[e].p(t,o):(rt(),st(i[l],1,1,(()=>{i[l]=null})),nt(),r=i[e],r?r.p(t,o):(r=i[e]=s[e](t),r.c()),ot(r,1),r.m(n.parentNode,n))},i(t){o||(ot(r),o=!0)},o(t){st(r),o=!1},d(t){i[e].d(t),t&&j(n)}}}const Dt="routify-fragment-context";function Ht(t,e,r){let{$$slots:n={},$$scope:o}=e,{node:s}=e,{passthrough:i}=e;const a=h(c({},W(Dt)),{node:s});let l;return T(Dt,a),s.module&&s.getRawComponent().then((t=>r(2,l=t))),t.$$set=t=>{"node"in t&&r(0,s=t.node),"passthrough"in t&&r(1,i=t.passthrough),"$$scope"in t&&r(5,o=t.$$scope)},[s,i,l,a,n,o]}class Lt extends ft{constructor(t){super(),dt(this,t,Ht,At,N,{node:0,passthrough:1})}}class Bt extends Ft{constructor(){super(...arguments),g(this,e,{}),f(this,"importTree",(t=>{const e=[[this,t]];for(;e.length;){const[t,r]=e.pop(),n=r,{children:o}=n,s=d(n,["children"]);Object.assign(t,s);for(const i of o){const n=t.createChild(r.name||r.rootName||"");e.push([n,i])}}return this}))}get regex(){const{name:t}=this;return m(this,e)[t]||(m(this,e)[t]=this.instance.utils.getRegexFromName(this.name)),m(this,e)[t]}set regex(t){m(this,e)[this.name]=new RegExp(t)}get children(){return this.instance.nodeIndex.filter((t=>t.parent===this)).sort(((t,e)=>(t.meta.order||0)-(e.meta.order||0)))}get pages(){return this.children.filter((t=>"index"!==t.name)).filter((t=>!t.meta.fallback)).filter((t=>!t.name.startsWith("_"))).filter((t=>!t.name.includes("["))).filter((t=>{var e;return!(!1===(null==(e=t.meta)?void 0:e.order))}))}getRawComponent(){return this.module&&new Promise((t=>{const e=this.module();t(e.then?e.then((t=>t.default)):e.default)}))}get component(){const t=this;return function(e){return e.props=h(c({},e.props),{passthrough:e.props,node:t}),new Lt(c({},e))}}appendChild(t){t.instance&&(t.parent=this)}get _fallback(){var t;return this.children.find((t=>t.meta.fallback))||(null==(t=this.parent)?void 0:t._fallback)}}e=new WeakMap;class Tt extends class{constructor(t){f(this,"Node",Ft),f(this,"mode","runtime"),f(this,"nodeIndex",[]),f(this,"rootNodes",{})}createNode(t,e){return new this.Node(t,e,this)}}{constructor(t){super(),f(this,"Node",Bt),f(this,"mode","runtime"),f(this,"routers",[]),f(this,"rootNodes",{}),this.options=t,t.routes&&(this.rootNodes[t.routes.rootName||"unnamed"]=this.createNode(t.routes.rootName).importTree(t.routes)),this.utils=new It,this.global=Ct.register(this),Object.defineProperty(this,"routers",{enumerable:!1}),this.log=this.global.log}}const Wt=t=>{const e=[],r=t=>(e.push(t),()=>e.splice(e.indexOf(t),1));return r.hooks=e,r.run=t(e),r},qt=t=>Wt((t=>(e,...r)=>t.reduce(((t,n)=>(null==t?void 0:t.then)?t.then((t=>n(e,...r))):n(e,...r)),e)));class Mt extends Nt{constructor(t){super(t),f(this,"reflect",(()=>{const{mode:t}=P(this.router.activeRoute);if("popState"===t)return!1;const{routers:e,browserAdapter:r}=this.router.instance.global,n=e.filter((t=>t.urlReflector instanceof this.constructor)),o=r.toBrowser(n);history[`${t}Native`]({},"",o)}));const{instance:e,urlRewrites:r}=t,{urlFromBrowser:n,browserAdapter:o}=e.global;history.onPushstate||function(){const t={onPushstate:qt(),onReplacestate:qt(),onPopstate:qt()};Object.assign(history,t);const{pushState:e,replaceState:r}=history;history.pushStateNative=e,history.replaceStateNative=r,history.pushState=t.onPushstate.run,history.replaceState=t.onReplacestate.run,window.addEventListener("popstate",t.onPopstate.run)}();const s=e=>function(n,s,i){var a,l;const u=null!=(l=null==(a=null==n?void 0:n.routify)?void 0:a.router)&&l;if(!1===u)i=o.toRouter(i,t);else if(u!==t.name)return!1;for(const e of r)i=e.toInternal(i,{router:t});t.url[e](i)};this.absorb=()=>t.url.replace(n(t)),this._pushstateHandler=s("push"),this._replacestateHandler=s("replace"),this._popstateHandler=()=>t.url.pop(n(t))}install(){this.hooks=[history.onPushstate(this._pushstateHandler),history.onReplacestate(this._replacestateHandler),history.onPopstate(this._popstateHandler)],P(this.router.activeRoute)?this.reflect():this.absorb()}uninstall(){this.hooks.forEach((t=>t())),setTimeout((()=>this.reflect()))}}class Vt extends Nt{}const Jt=(t,e)=>{e=e||{name:"",beforeRouterInit:[],afterRouterInit:[],urlRewrite:[],beforeUrlChange:[],afterUrlChange:[],transformFragments:[],onDestroy:[]};const r=t,{plugins:n}=r;return[...n||[],d(r,["plugins"])].forEach((t=>{"plugin"in t&&Jt(t,e),Object.entries(t).forEach((([t,r])=>{Array.isArray(e[t])?e[t].push(...[r].flat().filter(Boolean)):e[t]=r||e[t]}))})),e},Kt=class{constructor(t){f(this,"pendingRoute",xt(null)),f(this,"activeRoute",xt(null)),g(this,r,null),f(this,"urlRewrites",[]),f(this,"beforeRouterInit",qt()),f(this,"afterRouterInit",qt()),f(this,"beforeUrlChange",Wt((t=>(e,...r)=>t.reduce(((t,e)=>(null==t?void 0:t.then)?t.then((t=>t&&e(t,...r))):t&&e(t,...r)),e||!0)))),f(this,"afterUrlChange",qt()),f(this,"transformFragments",Wt((t=>(e,...r)=>t.reduce(((t,e)=>(null==t?void 0:t.then)?t.then((t=>e(t,...r))):e(t,...r)),e)))),f(this,"onDestroy",qt()),f(this,"parentElem",null),f(this,"queryHandler",{parse:t=>{return e=new URLSearchParams(t),[...e].reduce(((t,[e,r])=>(t[e]=r,t)),{});var e},stringify:t=>"?"+new URLSearchParams(t).toString()}),f(this,"scrollHandler",_t),f(this,"url",{internal:()=>this.url.getPending()||this.url.getActive(),external:()=>this.getExternalUrl(),getActive:()=>{var t;return null==(t=P(this.activeRoute))?void 0:t.url},getPending:()=>{var t;return null==(t=P(this.pendingRoute))?void 0:t.url},toString:()=>this.url.internal(),set:this._setUrl,push:t=>this._setUrl(t,"pushState"),replace:t=>this._setUrl(t,"replaceState"),pop:t=>this._setUrl(t,"popState")}),f(this,"ready",(()=>new Promise((t=>{let e;e=this.activeRoute.subscribe((r=>{r&&t(),e&&e()}))})))()),f(this,"history",[]),f(this,"setParentElem",(t=>this.parentElem=t)),f(this,"getExternalUrl",(t=>this.urlRewrites.reduce(((t,e)=>e.toExternal(t,{router:this})),t||this.url.internal()))),f(this,"getInternalUrl",(t=>this.urlRewrites.reduce(((t,e)=>e.toInternal(t,{router:this})),t)));const{subscribe:e,set:n}=mt(this);this.subscribe=e,this.triggerStore=()=>n(this),this.init(t),this.params=gt(this.activeRoute,(t=>t.params)),this.afterUrlChange((()=>setTimeout((()=>m(this,r).reflect())))),this.afterUrlChange(this.scrollHandler.run),this.activeRoute.get=()=>P(this.activeRoute),this.pendingRoute.get=()=>P(this.pendingRoute)}init(t){const e=!this.options;var r;r=t,t=Object.fromEntries(Object.entries(r).filter((([t,e])=>null!=e))),this.options=Jt(c(c({},this.options),t));let{instance:n,rootNode:o,name:s,routes:i,urlRewrite:a,urlReflector:l,url:u,passthrough:h,beforeUrlChange:d,afterUrlChange:f,transformFragments:p,onDestroy:m,beforeRouterInit:g,afterRouterInit:$}=this.options;d.forEach(this.beforeUrlChange),p.forEach(this.transformFragments),f.forEach(this.afterUrlChange),m.forEach(this.onDestroy),g.forEach(this.beforeRouterInit),$.forEach(this.afterRouterInit),this.beforeRouterInit.run({router:this,firstInit:e});const y=(t=>{try{return W(t)}catch(e){}})("routify-fragment-context");this.instance=n||this.instance||(null==y?void 0:y.route.router.instance)||Ct.instances[0]||new Tt({}),this.name=s,this.urlRewrites=a,!h||h instanceof Kt||(h=(null==y?void 0:y.route.router)||h),this.passthrough=h||this.passthrough,Ct.instances.forEach((t=>{const e=t.routers.indexOf(this);-1!==e&&t.routers.splice(e,1)})),this.instance.routers.push(this),i&&this.importRoutes(i),this.parentCmpCtx=y,this.rootNode=o||this.rootNode||this.instance.rootNodes.default,this.url.getActive()&&this._setUrl(this.url.getActive(),"pushState",!0);(!this.urlReflector||l&&!(this.urlReflector instanceof l))&&(l=l||("undefined"!=typeof window?Mt:Vt),this.setUrlReflector(l)),u&&this.url.replace(u),this.triggerStore(),this.afterRouterInit.run({router:this,firstInit:e})}importRoutes(t){this.rootNode=this.instance.createNode().importTree(t),this.instance.rootNodes[t.rootName||"unnamed"]=this.rootNode}async _setUrl(t,e,r){r||(t=this.getInternalUrl(t)),t=(t=t||"/").replace(/(.+)\/+([#?]|$)/,"$1$2");const{activeRoute:n,pendingRoute:o}=this;n.get(),t.startsWith("/")||(t=t.replace(new URL(t).origin,""));const s=new Rt(this,t,e);return((...t)=>t.map((t=>JSON.stringify([null==t?void 0:t.allFragments,null==t?void 0:t.url]))).reduce(((t,e)=>t===e&&e)))(o.get()||n.get(),s)||(o.set(s),await s.loadRoute()),!0}destroy(){this.instance.routers=this.instance.routers.filter((t=>t!==this)),this.onDestroy.run({router:this})}get urlReflector(){return m(this,r)}setUrlReflector(t){var e;null==(e=m(this,r))||e.uninstall(),$(this,r,new t(this)),m(this,r).install(),this.triggerStore()}};let zt=Kt;function Gt(t){let e;const r=t[2].default,n=_(r,t,t[1],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,[o]){n&&n.p&&(!e||2&o)&&I(n,r,t,t[1],e?U(r,t[1],o,null):F(t[1]),null)},i(t){e||(ot(n,t),e=!0)},o(t){st(n,t),e=!1},d(t){n&&n.d(t)}}}function Qt(t,e,r){let{$$slots:n={},$$scope:o}=e,{context:s=null}=e;return t.$$set=t=>{"context"in t&&r(0,s=t.context),"$$scope"in t&&r(1,o=t.$$scope)},[s,o,n]}r=new WeakMap;class Xt extends ft{constructor(t){super(),dt(this,t,Qt,Gt,N,{context:0})}}function Yt(t){let e,r;return e=new ne({props:{fragments:t[5],props:t[1],decorator:t[0]}}),{c(){lt(e.$$.fragment)},m(t,n){ut(e,t,n),r=!0},p(t,r){const n={};32&r&&(n.fragments=t[5]),2&r&&(n.props=t[1]),1&r&&(n.decorator=t[0]),e.$set(n)},i(t){r||(ot(e.$$.fragment,t),r=!0)},o(t){st(e.$$.fragment,t),r=!1},d(t){ct(e,t)}}}function Zt(t){let e,r,n=t[5].length&&Yt(t);return{c(){n&&n.c(),e=D()},m(t,o){n&&n.m(t,o),S(t,e,o),r=!0},p(t,r){t[5].length?n?(n.p(t,r),32&r&&ot(n,1)):(n=Yt(t),n.c(),ot(n,1),n.m(e.parentNode,e)):n&&(rt(),st(n,1,1,(()=>{n=null})),nt())},i(t){r||(ot(n),r=!0)},o(t){st(n),r=!1},d(t){n&&n.d(t),t&&j(e)}}}function te(t){var e;let r,n,o;const s=[{context:t[2]},t[1],null==(e=t[4])?void 0:e.props];var i=t[3].node.module().default;function a(t){let e={$$slots:{default:[Zt,({props:t,decorator:e})=>({1:t,0:e}),({props:t,decorator:e})=>(t?2:0)|(e?1:0)]},$$scope:{ctx:t}};for(let r=0;r<s.length;r+=1)e=b(e,s[r]);return{props:e}}return i&&(r=new i(a(t))),{c(){r&&lt(r.$$.fragment),n=D()},m(t,e){r&&ut(r,t,e),S(t,n,e),o=!0},p(t,e){var o;const l=22&e?it(s,[4&e&&{context:t[2]},2&e&&at(t[1]),16&e&&at(null==(o=t[4])?void 0:o.props)]):{};if(547&e&&(l.$$scope={dirty:e,ctx:t}),i!==(i=t[3].node.module().default)){if(r){rt();const t=r;st(t.$$.fragment,1,0,(()=>{ct(t,1)})),nt()}i?(r=new i(a(t)),lt(r.$$.fragment),ot(r.$$.fragment,1),ut(r,n.parentNode,n)):r=null}else i&&r.$set(l)},i(t){o||(r&&ot(r.$$.fragment,t),o=!0)},o(t){r&&st(r.$$.fragment,t),o=!1},d(t){t&&j(n),r&&ct(r,t)}}}function ee(t){let e,r,n;var o=t[0]||Xt;function s(t){return{props:{context:t[2],$$slots:{default:[te]},$$scope:{ctx:t}}}}return o&&(e=new o(s(t))),{c(){e&&lt(e.$$.fragment),r=D()},m(t,o){e&&ut(e,t,o),S(t,r,o),n=!0},p(t,[n]){const i={};if(4&n&&(i.context=t[2]),575&n&&(i.$$scope={dirty:n,ctx:t}),o!==(o=t[0]||Xt)){if(e){rt();const t=e;st(t.$$.fragment,1,0,(()=>{ct(t,1)})),nt()}o?(e=new o(s(t)),lt(e.$$.fragment),ot(e.$$.fragment,1),ut(e,r.parentNode,r)):e=null}else o&&e.$set(i)},i(t){n||(e&&ot(e.$$.fragment,t),n=!0)},o(t){e&&st(e.$$.fragment,t),n=!1},d(t){t&&j(r),e&&ct(e,t)}}}function re(t,e,r){let n,o,s,i,a,{fragments:l}=e,{decorator:u=null}=e,{props:c={}}=e,h={};return T("routify-fragment-context",h),t.$$set=t=>{"fragments"in t&&r(6,l=t.fragments),"decorator"in t&&r(0,u=t.decorator),"props"in t&&r(1,c=t.props)},t.$$.update=()=>{64&t.$$.dirty&&r(3,[n,...o]=[...l],n,(r(5,o),r(6,l))),8&t.$$.dirty&&r(7,({node:s,load:i,route:a}=n),s,(r(4,i),r(3,n),r(6,l)),(r(8,a),r(3,n),r(6,l))),412&t.$$.dirty&&r(2,h=Object.assign(h,{route:a,node:s,load:i,fragment:n}))},[u,c,h,n,i,o,l,s,a]}class ne extends ft{constructor(t){super(),dt(this,t,re,ee,N,{fragments:6,decorator:0,props:1})}}function oe(t){let e,r,n,o,s,i;return r=new ne({props:{fragments:t[2],decorator:t[1]}}),{c(){var t,n,o;e=k("div"),lt(r.$$.fragment),t="display",n="contents",e.style.setProperty(t,n,o?"important":"")},m(a,l){S(a,e,l),ut(r,e,null),o=!0,s||(i=O(n=t[5].call(null,e)),s=!0)},p(t,e){const n={};4&e&&(n.fragments=t[2]),2&e&&(n.decorator=t[1]),r.$set(n)},i(t){o||(ot(r.$$.fragment,t),o=!0)},o(t){st(r.$$.fragment,t),o=!1},d(t){t&&j(e),ct(r),s=!1,i()}}}function se(t){let e,r,n,o;return{c(){e=k("div")},m(s,i){S(s,e,i),n||(o=O(r=t[0].setParentElem(e)),n=!0)},d(t){t&&j(e),n=!1,o()}}}function ie(t){let e,r,n,o=t[3]&&oe(t),s=!t[0].parentElem&&se(t);return{c(){o&&o.c(),e=A(" "),s&&s.c(),r=D()},m(t,i){o&&o.m(t,i),S(t,e,i),s&&s.m(t,i),S(t,r,i),n=!0},p(t,[n]){t[3]?o?(o.p(t,n),8&n&&ot(o,1)):(o=oe(t),o.c(),ot(o,1),o.m(e.parentNode,e)):o&&(rt(),st(o,1,1,(()=>{o=null})),nt()),t[0].parentElem?s&&(s.d(1),s=null):s||(s=se(t),s.c(),s.m(r.parentNode,r))},i(t){n||(ot(o),n=!0)},o(t){st(o),n=!1},d(t){o&&o.d(t),t&&j(e),s&&s.d(t),t&&j(r)}}}function ae(t,e,r){let n,o,s,i=y;t.$$.on_destroy.push((()=>i()));let{router:a=null}=e,{routes:l=null}=e,{decorator:u=null}=e,{urlReflector:c=null}=e,{instance:h=null}=e,{urlRewrite:d=null}=e,{url:f=null}=e,{name:p=null}=e,{rootNode:m=null}=e,{passthrough:g=null}=e,{beforeRouterInit:$=null}=e,{afterRouterInit:b=null}=e,{beforeUrlChange:w=null}=e,{afterUrlChange:v=null}=e,{transformFragments:R=null}=e,{onDestroy:x=null}=e,{plugins:N=null}=e;const P=t=>{const e=(t=>{const e=t.target.closest("a"),r=e&&e.href;if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button||t.key&&"Enter"!==t.key||t.defaultPrevented)return;if(!r||e.target||e.host!==location.host)return;const n=new URL(r),o=n.pathname+n.search+n.hash;return t.preventDefault(),o})(t);e&&a.url.push(e)};var _;return"undefined"!=typeof window&&(_=()=>a.destroy(),B().$$.on_destroy.push(_)),t.$$set=t=>{"router"in t&&r(0,a=t.router),"routes"in t&&r(6,l=t.routes),"decorator"in t&&r(1,u=t.decorator),"urlReflector"in t&&r(7,c=t.urlReflector),"instance"in t&&r(8,h=t.instance),"urlRewrite"in t&&r(9,d=t.urlRewrite),"url"in t&&r(10,f=t.url),"name"in t&&r(11,p=t.name),"rootNode"in t&&r(12,m=t.rootNode),"passthrough"in t&&r(13,g=t.passthrough),"beforeRouterInit"in t&&r(14,$=t.beforeRouterInit),"afterRouterInit"in t&&r(15,b=t.afterRouterInit),"beforeUrlChange"in t&&r(16,w=t.beforeUrlChange),"afterUrlChange"in t&&r(17,v=t.afterUrlChange),"transformFragments"in t&&r(18,R=t.transformFragments),"onDestroy"in t&&r(19,x=t.onDestroy),"plugins"in t&&r(20,N=t.plugins)},t.$$.update=()=>{if(2096065&t.$$.dirty){const t={instance:h,rootNode:m,name:p,routes:l,urlRewrite:d,urlReflector:c,passthrough:g,beforeRouterInit:$,afterRouterInit:b,beforeUrlChange:w,afterUrlChange:v,transformFragments:R,onDestroy:x,plugins:N};a?a.init(t):r(0,a=new zt(t))}1025&t.$$.dirty&&f&&f!==a.url.internal()&&a.url.replace(f),1&t.$$.dirty&&(r(4,n=a.activeRoute),i(),i=E(n,(t=>r(3,s=t)))),8&t.$$.dirty&&r(2,o=(null==s?void 0:s.fragments)||[]),t.$$.dirty},[a,u,o,s,n,t=>{a.passthrough||(t.addEventListener("click",P),t.addEventListener("keydown",P))},l,c,h,d,f,p,m,g,$,b,w,v,R,x,N]}class le extends ft{constructor(t){super(),dt(this,t,ae,ie,N,{router:0,routes:6,decorator:1,urlReflector:7,instance:8,urlRewrite:9,url:10,name:11,rootNode:12,passthrough:13,beforeRouterInit:14,afterRouterInit:15,beforeUrlChange:16,afterUrlChange:17,transformFragments:18,onDestroy:19,plugins:20})}}export{le as R,ft as S,st as a,S as b,lt as c,ct as d,k as e,j as f,dt as i,ut as m,y as n,N as s,ot as t};
